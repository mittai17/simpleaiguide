---
interface Props {
    count?: number;
}

const { count = 40 } = Astro.props;
---

<canvas
    id="starfield"
    data-count={count}
    class="absolute inset-0 w-full h-full -z-10 opacity-50 pointer-events-none"
></canvas>

<script>
    const canvas = document.getElementById("starfield") as HTMLCanvasElement;
    const ctx = canvas.getContext("2d");

    if (canvas && ctx) {
        // Read count from data attribute or default to 40
        const count = parseInt(canvas.dataset.count || "40", 10);

        let width = 0;
        let height = 0;
        let stars: { x: number; y: number; size: number; speed: number }[] = [];

        const resize = () => {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
            initStars();
        };

        const initStars = () => {
            stars = [];
            for (let i = 0; i < count; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    size: Math.random() * 2,
                    speed: Math.random() * 0.5 + 0.1,
                });
            }
        };

        const animate = () => {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = "#94a3b8";

            stars.forEach((star) => {
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();

                star.y -= star.speed;
                if (star.y < 0) {
                    star.y = height;
                    star.x = Math.random() * width;
                }
            });

            requestAnimationFrame(animate);
        };

        window.addEventListener("resize", resize);
        resize();
        animate();
    }
</script>
