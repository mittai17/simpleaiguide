---
import Layout from "../../components/Layout.astro";
import Sidebar from "../../components/Sidebar.astro";
import Search from "../../components/Search.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Calculate Reading Time Helper
const getReadingTime = (body: string) => {
  const wordsPerMinute = 200;
  const wordCount = body.split(/\s+/).length;
  return Math.ceil(wordCount / wordsPerMinute);
};

const pageSize = 6;
const currentPosts = posts.slice(0, pageSize);
const totalPages = Math.ceil(posts.length / pageSize);

const featuredPost = currentPosts[0];
const otherPosts = currentPosts.slice(1);
---

<Layout title="Blog - Simple AI Guide">
    <section class="container mx-auto px-4 py-12 md:py-20 relative overflow-hidden">
        <!-- Background Decor -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-indigo-500/10 blur-[120px] rounded-full pointer-events-none -z-10"></div>

        <div class="max-w-4xl mx-auto mb-16 text-center space-y-6">
            <span class="inline-block py-1 px-3 rounded-full bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 font-bold tracking-wider uppercase text-xs border border-indigo-100 dark:border-indigo-800">
                The Archive
            </span>
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-extrabold tracking-tight text-slate-900 dark:text-white mb-4">
                Latest <span class="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-400 dark:to-purple-400">Articles</span>
            </h1>
            <p class="text-xl text-slate-600 dark:text-slate-400 leading-relaxed max-w-2xl mx-auto">
                Deep dives, tutorials, and insights from the frontier of Artificial Intelligence.
            </p>

            <!-- Search Bar Integration -->
            <div class="flex justify-center mt-8">
                <div class="w-full max-w-md transform transition-all duration-300 hover:scale-105">
                     <Search />
                </div>
            </div>
        </div>

        <div class="flex flex-col lg:flex-row gap-12">
            <!-- Main Content -->
            <div class="w-full lg:w-3/4">
                
                <!-- Featured Post Hero -->
                {featuredPost && (
                    <article class="mb-16 group relative rounded-3xl bg-slate-900 text-white overflow-hidden shadow-2xl hover:shadow-indigo-500/20 transition-all duration-500 ring-1 ring-white/10">
                        <!-- Hero Image Background (Optional if post has image) -->
                        {featuredPost.data.heroImage && (
                             <div class="absolute inset-0 z-0 opacity-40 group-hover:opacity-30 transition-opacity duration-700">
                                <img src={featuredPost.data.heroImage} alt="" class="w-full h-full object-cover transform group-hover:scale-105 transition-transform duration-700" />
                                <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-slate-900/80 to-transparent"></div>
                             </div>
                        )}
                        
                        <!-- Background Decoration (fallback/overlay) -->
                        <div class="absolute inset-0 z-0 pointer-events-none mix-blend-overlay">
                            <div class="absolute top-0 right-0 w-96 h-96 bg-indigo-500/30 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
                            <div class="absolute bottom-0 left-0 w-96 h-96 bg-purple-500/30 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2"></div>
                        </div>

                        <div class="relative z-10 p-8 md:p-12 lg:p-16 flex flex-col items-start h-full justify-end min-h-[500px]">
                            <div class="flex flex-wrap items-center gap-3 mb-6 animate-fade-in-up">
                                <span class="px-3 py-1 rounded-full bg-indigo-500/20 border border-indigo-400/30 text-indigo-300 text-xs font-bold uppercase tracking-wider shadow-sm backdrop-blur-sm">
                                    {featuredPost.data.category}
                                </span>
                                <span class="w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse"></span>
                                <time datetime={featuredPost.data.pubDate.toISOString()} class="text-xs text-indigo-200 uppercase tracking-wider font-medium">
                                    {featuredPost.data.pubDate.toLocaleDateString("en-US", { month: "long", day: "numeric", year: "numeric" })}
                                </time>
                                <span class="text-xs text-indigo-200/60">•</span>
                                <span class="text-xs text-indigo-200 uppercase tracking-wider font-medium">
                                    {getReadingTime(featuredPost.body)} min read
                                </span>
                            </div>

                            <h2 class="text-3xl md:text-5xl font-bold mb-6 leading-tight group-hover:text-indigo-300 transition-colors max-w-4xl">
                                <a href={`/blog/${featuredPost.slug}`} class="block focus:outline-none focus:text-indigo-300">
                                    <span class="absolute inset-0" aria-hidden="true"></span>
                                    {featuredPost.data.title}
                                </a>
                            </h2>

                            <p class="text-lg md:text-xl text-slate-300 mb-8 max-w-2xl leading-relaxed line-clamp-3">
                                {featuredPost.data.description}
                            </p>

                            <div class="flex items-center gap-2 text-indigo-400 font-bold group-hover:text-white transition-colors">
                                Read Full Article
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 group-hover:translate-x-1 transition-transform">
                                    <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                    </article>
                )}

                <div class="flex items-center gap-4 mb-8">
                    <h3 class="text-2xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6 text-indigo-500">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" />
                        </svg>
                        Recent Articles
                    </h3>
                    <div class="h-px bg-slate-200 dark:bg-slate-700 flex-grow"></div>
                </div>

                <div class="grid gap-8 md:grid-cols-2">
                    {otherPosts.map((post) => (
                        <article class="group relative flex flex-col h-full rounded-2xl bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-800 overflow-hidden hover:shadow-2xl hover:shadow-indigo-500/10 hover:-translate-y-1 transition-all duration-300">
                             <!-- Gradient Border Highlight -->
                            <div class="absolute inset-0 border-2 border-transparent group-hover:border-indigo-500/20 rounded-2xl transition-all duration-300 z-10 pointer-events-none"></div>
                            
                            <!-- Image (if available) or Pattern -->
                            <div class="h-48 overflow-hidden relative bg-slate-100 dark:bg-slate-800">
                                {post.data.heroImage ? (
                                    <img src={post.data.heroImage} alt={post.data.title} class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" />
                                ) : (
                                    <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-purple-500/5 group-hover:from-indigo-500/10 group-hover:to-purple-500/10 transition-colors"></div>
                                )}
                                <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-slate-900/60 to-transparent">
                                     <span class="inline-block px-2 py-1 rounded-md bg-white/90 dark:bg-slate-900/90 text-indigo-600 dark:text-indigo-400 text-[10px] font-bold uppercase tracking-wider shadow-sm backdrop-blur-sm">
                                        {post.data.category}
                                    </span>
                                </div>
                            </div>

                            <div class="p-6 flex flex-col flex-grow">
                                <div class="flex items-center gap-3 mb-3 text-xs text-slate-500 dark:text-slate-400">
                                    <time datetime={post.data.pubDate.toISOString()} class="font-medium uppercase tracking-wider">
                                        {post.data.pubDate.toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" })}
                                    </time>
                                    <span>•</span>
                                    <span>{getReadingTime(post.body)} min read</span>
                                </div>

                                <h2 class="text-xl font-bold mb-3 text-slate-900 dark:text-white group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors leading-tight">
                                    <a href={`/blog/${post.slug}`} class="before:absolute before:inset-0 outline-none">
                                        {post.data.title}
                                    </a>
                               </h2>

                                <p class="text-slate-600 dark:text-slate-400 mb-6 line-clamp-3 text-sm leading-relaxed flex-grow">
                                    {post.data.description}
                                </p>

                                <div class="mt-auto pt-4 border-t border-slate-100 dark:border-slate-800 flex items-center justify-between text-sm">
                                    <span class="font-bold text-indigo-600 dark:text-indigo-400 group-hover:translate-x-1 transition-transform flex items-center gap-1">
                                        Read Article
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                                            <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </article>
                    ))}
                </div>

                <!-- Pagination Controls -->
                <div class="mt-16 flex justify-between items-center border-t border-slate-200 dark:border-slate-800 pt-8">
                    <span class="text-sm text-slate-500 dark:text-slate-400">
                        Page 1 of {totalPages}
                    </span>
                    {totalPages > 1 && (
                        <a href="/blog/page/2" class="px-6 py-2.5 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 text-slate-700 dark:text-slate-300 font-bold hover:bg-slate-50 dark:hover:bg-slate-700 hover:border-indigo-300 dark:hover:border-indigo-500 transition-all flex items-center gap-2 group shadow-sm">
                            Next Page
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 group-hover:translate-x-1 transition-transform">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
                            </svg>
                        </a>
                    )}
                </div>

            </div>

             <!-- Sidebar (Sticky) -->
            <aside class="w-full lg:w-1/4">
                <div class="sticky top-24 space-y-8">
                     <!-- Mini Profile (Optional) -->
                    <div class="p-6 bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm text-center">
                        <div class="w-20 h-20 bg-indigo-100 dark:bg-slate-800 rounded-full mx-auto mb-4 overflow-hidden border-2 border-indigo-100 dark:border-gray-700">
                            <!-- Placeholder avatar or logo -->
                             <img src="/favicon.svg" alt="Profile" class="w-full h-full object-cover p-2" />
                        </div>
                        <h3 class="font-bold text-slate-900 dark:text-white">Simple AI Guide</h3>
                        <p class="text-xs text-slate-500 dark:text-slate-400 mt-2 mb-4">
                            Navigating the world of Artificial Intelligence, one guide at a time.
                        </p>
                    </div>

                    <Sidebar />
                </div>
            </aside>
        </div>
    </section>
</Layout>
