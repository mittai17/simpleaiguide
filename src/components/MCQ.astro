---
interface Props {
    question: string;
    options: string[];
    correct: string;
    explanation?: string;
}

const { question, options, correct, explanation } = Astro.props;
const id = Math.random().toString(36).substring(7);
---

<div
    class="my-8 p-6 bg-slate-50 rounded-xl border border-slate-200 mcq-container"
    data-correct={correct}
>
    <h3 class="text-lg font-bold text-slate-900 mb-4">{question}</h3>

    <div class="space-y-3">
        {
            options.map((option) => (
                <button
                    class="mcq-option w-full text-left p-3 rounded-lg border border-slate-200 bg-white hover:bg-indigo-50 hover:border-indigo-200 transition-all text-slate-700 font-medium"
                    data-value={option}
                >
                    {option}
                </button>
            ))
        }
    </div>

    <div class="mcq-feedback hidden mt-4 p-4 rounded-lg text-sm"></div>

    {
        explanation && (
            <div class="mcq-explanation hidden mt-4 text-sm text-slate-600 bg-blue-50 p-4 rounded-lg border border-blue-100">
                <strong>Explanation:</strong> {explanation}
            </div>
        )
    }
</div>

<script>
    function setupMCQs() {
        const containers = document.querySelectorAll(".mcq-container");

        containers.forEach((container) => {
            const correct = container.getAttribute("data-correct");
            const options = container.querySelectorAll(".mcq-option");
            const feedback = container.querySelector(".mcq-feedback");
            const explanation = container.querySelector(".mcq-explanation");

            options.forEach((btn) => {
                btn.addEventListener("click", () => {
                    // Disable all buttons
                    options.forEach(
                        (b) => ((b as HTMLButtonElement).disabled = true),
                    );

                    const selected = btn.getAttribute("data-value");
                    const isCorrect = selected === correct;

                    if (isCorrect) {
                        btn.classList.add(
                            "bg-green-100",
                            "border-green-500",
                            "text-green-800",
                        );
                        if (feedback) {
                            feedback.textContent = "Correct! ðŸŽ‰";
                            feedback.classList.remove("hidden");
                            feedback.classList.add(
                                "bg-green-100",
                                "text-green-800",
                            );
                        }
                    } else {
                        btn.classList.add(
                            "bg-red-100",
                            "border-red-500",
                            "text-red-800",
                        );
                        // Highlight correct answer
                        options.forEach((b) => {
                            if (b.getAttribute("data-value") === correct) {
                                b.classList.add(
                                    "bg-green-100",
                                    "border-green-500",
                                    "text-green-800",
                                );
                            }
                        });
                        if (feedback) {
                            feedback.textContent = "Incorrect.";
                            feedback.classList.remove("hidden");
                            feedback.classList.add(
                                "bg-red-100",
                                "text-red-800",
                            );
                        }
                    }

                    if (explanation) {
                        explanation.classList.remove("hidden");
                    }
                });
            });
        });
    }

    // Run on load
    setupMCQs();

    // Run on view transitions (if enabled)
    document.addEventListener("astro:page-load", setupMCQs);
</script>
