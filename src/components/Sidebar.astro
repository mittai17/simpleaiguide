---
import { getCollection } from "astro:content";

const posts = await getCollection("blog");
const categories = [...new Set(posts.map((post) => post.data.category))].map(
  (category) => {
    return {
      name: category,
      slug: category.toLowerCase().replace(/\s+/g, "-"),
      count: posts.filter((p) => p.data.category === category).length,
    };
  },
);
---

<aside class="w-full lg:w-1/4 space-y-8">
  <!-- Categories Widget -->
  <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
    <h3 class="text-lg font-bold text-slate-900 mb-4 flex items-center gap-2">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-5 h-5 text-indigo-600"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.593l4.39-1.463a2.25 2.25 0 00.999-3.32l-2.335-3.892c-.375-.625-.88-1.143-1.466-1.507l-4.238-2.648a2.25 2.25 0 00-1.1-.286h-1.543z"
        ></path>
      </svg>
      Categories
    </h3>
    <ul class="space-y-2">
      {
        categories.map((category) => (
          <li>
            <a
              href={`/simpleaiguide/blog/${category.slug}`}
              class="flex items-center justify-between group p-2 rounded-lg hover:bg-slate-50 transition-colors"
            >
              <span class="text-slate-600 group-hover:text-indigo-600 transition-colors font-medium">
                {category.name}
              </span>
              <span class="text-xs font-bold text-slate-400 bg-slate-100 px-2 py-1 rounded-full group-hover:bg-indigo-50 group-hover:text-indigo-600 transition-colors">
                {category.count}
              </span>
            </a>
          </li>
        ))
      }
    </ul>
  </div>

  <!-- Newsletter Widget -->
  <div
    class="bg-gradient-to-br from-indigo-600 to-purple-700 p-6 rounded-2xl text-white shadow-lg relative overflow-hidden"
  >
    <div
      class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full blur-2xl -mr-16 -mt-16 pointer-events-none"
    >
    </div>

    <h3 class="text-lg font-bold mb-2 relative z-10">Join the Mission</h3>
    <p class="text-indigo-100 text-sm mb-4 relative z-10">
      Get the latest AI tools and guides delivered to your inbox.
    </p>

    <form class="space-y-2 relative z-10" onsubmit="event.preventDefault();">
      <input
        type="email"
        placeholder="Your email"
        class="w-full px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-indigo-200 focus:outline-none focus:ring-2 focus:ring-white/50 text-sm"
      />
      <button
        class="w-full bg-white text-indigo-600 font-bold py-2 rounded-lg text-sm hover:bg-indigo-50 transition-colors"
      >
        Join Now
      </button>
    </form>
  </div>
</aside>
