---
import Navbar from "./Navbar.astro";
import Footer from "./Footer.astro";
import ScrollRocket from "./ScrollRocket.astro";
import CookieConsent from "./CookieConsent.astro";
import "../styles/global.css";

import { ViewTransitions } from "astro:transitions";

interface Props {
	title: string;
	description?: string;
	image?: string;
	tags?: string[];
}

const {
	title,
	description = "Learn Artificial Intelligence for free. A step-by-step guide to AI, Machine Learning, and tools like ChatGPT for absolute beginners.",
	image = "/social-image.png",
	tags = [],
} = Astro.props;
---

<!doctype html>
<html lang="en" class="scroll-smooth">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content={description} />
		{tags.length > 0 && <meta name="keywords" content={tags.join(", ")} />}
		<meta name="viewport" content="width=device-width" />
		<meta name="theme-color" content="#4f46e5" />
		<ViewTransitions />

		<!-- Theme Initialization -->
		<script is:inline>
			const theme = localStorage.getItem("theme");
			if (
				theme === "dark" ||
				(!theme &&
					window.matchMedia("(prefers-color-scheme: dark)").matches)
			) {
				document.documentElement.classList.add("dark");
			} else {
				document.documentElement.classList.remove("dark");
			}
		</script>
		<link rel="icon" type="image/png" href="/favicon.png?v=2" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png?v=2" />
		<link rel="manifest" href="/manifest.json" />
		<link rel="sitemap" href="/sitemap-index.xml" />
		<link
			rel="alternate"
			type="application/rss+xml"
			title="Simple AI Guide RSS Feed"
			href="/rss.xml"
		/>
		<meta name="msvalidate.01" content="5D3BC345CEA4605D87CBD54F32267046" />
		<meta name="generator" content={Astro.generator} />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>
		<title>{title} | Simple AI Guide</title>

		<!-- Google Analytics (GA4) -->
		<script
			async
			src="https://www.googletagmanager.com/gtag/js?id=G-CDR0SNCM6R"
		></script>
		<script is:inline>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag("js", new Date());

			gtag("config", "G-CDR0SNCM6R");
		</script>

		<!-- Canonical URL -->
		<link rel="canonical" href={new URL(Astro.url.pathname, Astro.site)} />

		<!-- Open Graph / Facebook -->
		<meta property="og:type" content="website" />
		<meta property="og:url" content={Astro.url} />
		<meta property="og:title" content={title} />
		<meta property="og:description" content={description} />
		<meta property="og:image" content={new URL(image, Astro.site)} />

		<!-- Twitter -->
		<meta property="twitter:card" content="summary_large_image" />
		<meta property="twitter:url" content={Astro.url} />
		<meta property="twitter:title" content={title} />
		<meta property="twitter:image" content={new URL(image, Astro.site)} />

		<!-- Schema.org JSON-LD -->
		<script type="application/ld+json" is:inline>
			{
				"@context": "https://schema.org",
				"@graph": [
					{
						"@type": "WebSite",
						"@id": "https://simpleaiguide.tech/#website",
						"url": "https://simpleaiguide.tech/",
						"name": "Simple AI Guide",
						"description": "Learn Artificial Intelligence for free. A step-by-step guide to AI, Machine Learning, and tools like ChatGPT.",
						"publisher": {
							"@id": "https://simpleaiguide.tech/#organization"
						}
					},
					{
						"@type": "Organization",
						"@id": "https://simpleaiguide.tech/#organization",
						"name": "Simple AI Guide",
						"url": "https://simpleaiguide.tech/",
						"logo": {
							"@type": "ImageObject",
							"url": "https://simpleaiguide.tech/assets/logo.webp",
							"width": 512,
							"height": 512
						},
						"sameAs": ["https://twitter.com/simpleaiguide"]
					},
					{
						"@type": "SiteNavigationElement",
						"name": ["Home", "Learn", "Blog", "About", "Contact"],
						"url": [
							"https://simpleaiguide.tech/",
							"https://simpleaiguide.tech/learn",
							"https://simpleaiguide.tech/blog",
							"https://simpleaiguide.tech/about",
							"https://simpleaiguide.tech/contact"
						]
					}
				]
			}
		</script>
		<script
			async
			src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6043253151110287"
			crossorigin="anonymous"></script>
	</head>
	<body
		class="bg-white dark:bg-[#020617] text-slate-900 dark:text-slate-300 min-h-screen flex flex-col antialiased selection:bg-indigo-500/30 relative overflow-x-hidden transition-colors duration-300"
	>
		<!-- Dark Mode Radial Gradient Overlay -->
		<div
			class="fixed inset-0 z-0 pointer-events-none opacity-0 dark:opacity-100 transition-opacity duration-300 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-[#020617] to-[#020617]"
		>
		</div>
		<CookieConsent />
		<ScrollRocket />
		<!-- Global Space Background Removed for Performance -->

		<Navbar />
		<main class="flex-grow relative z-10">
			<slot />
		</main>
		<Footer />

		<style is:global></style>
		<!-- Konami Code Easter Egg -->
		<div
			id="rocket"
			class="fixed bottom-10 -left-20 text-6xl transition-transform duration-[2000ms] ease-linear z-50 pointer-events-none"
		>
			ðŸš€
		</div>

		<script>
			const konamiCode = [
				"ArrowUp",
				"ArrowUp",
				"ArrowDown",
				"ArrowDown",
				"ArrowLeft",
				"ArrowRight",
				"ArrowLeft",
				"ArrowRight",
				"b",
				"a",
			];
			let konamiIndex = 0;

			document.addEventListener("keydown", (e) => {
				if (
					e.key.toLowerCase() ===
					konamiCode[konamiIndex].toLowerCase()
				) {
					konamiIndex++;
					if (konamiIndex === konamiCode.length) {
						activateRocket();
						konamiIndex = 0;
					}
				} else {
					konamiIndex = 0;
				}
			});

			function activateRocket() {
				const rocket = document.getElementById("rocket");
				if (rocket) {
					rocket.style.transition = "none";
					rocket.style.transform = "translate(0, 0) rotate(45deg)";
					rocket.style.left = "-100px";
					rocket.style.bottom = "50px";

					// Force reflow
					void rocket.offsetWidth;

					rocket.style.transition = "all 3s ease-in-out";
					rocket.style.transform = `translate(${window.innerWidth + 200}px, -${window.innerHeight + 200}px) rotate(45deg)`;
				}
			}
		</script>

		<!-- Copy to Clipboard Script -->
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				const codeBlocks = document.querySelectorAll("pre");

				codeBlocks.forEach((pre) => {
					// Create separate wrapper relative to the pre
					const wrapper = document.createElement("div");
					wrapper.className = "relative group";

					pre.parentNode?.insertBefore(wrapper, pre);
					wrapper.appendChild(pre);

					const button = document.createElement("button");
					button.className =
						"absolute top-2 right-2 bg-slate-700/80 hover:bg-slate-900 text-white text-xs px-2.5 py-1.5 rounded-md opacity-0 group-hover:opacity-100 transition-all duration-200 border border-slate-600 backdrop-blur-sm";
					button.innerText = "Copy";
					button.setAttribute("aria-label", "Copy code");

					button.addEventListener("click", async () => {
						const code =
							pre.querySelector("code")?.innerText ||
							pre.innerText;
						try {
							await navigator.clipboard.writeText(code);
							button.innerText = "Copied!";
							button.classList.add("bg-green-600/80");
							setTimeout(() => {
								button.innerText = "Copy";
								button.classList.remove("bg-green-600/80");
							}, 2000);
						} catch (err) {
							console.error("Failed to copy:", err);
							button.innerText = "Error";
						}
					});

					wrapper.appendChild(button);
				});
			});
		</script>
	</body>
</html>
